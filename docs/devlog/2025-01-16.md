# 2025-01-16 Frontend Component Duplication Cleanup

## Component Duplication Analysis

After examining the frontend implementation, we've identified significant duplication issues that need to be addressed:

1. Store Subscription Duplication:
- Multiple components subscribing to same stores:
  * activeDomainFilter
  * currentWorkspace
  * currentDomain
- Each component maintaining separate copies of state
- No single source of truth

2. Panel/Layout Duplication:
- Right panel duplicated in layout and components
- Same widths (w-96) and styles repeated
- Multiple implementations of same UI patterns
- Inconsistent panel usage

3. State Management Duplication:
- Multiple workspace/domain trackers
- Redundant WebSocket connections
- Duplicate event listeners
- No centralized state management

4. Navigation/Search Duplication:
- Search functionality repeated
- Navigation elements duplicated
- Channel lists appearing multiple times
- Workspace selectors repeated

## Frontend Improvement Plan

1. Centralize State Management:
```typescript
// Create central store
export const appStore = {
  // Single source of truth
  workspace: writable(null),
  domain: writable(null),
  activeFilters: writable([]),
  
  // Single WebSocket connection
  socket: createWebSocket(),
  
  // Shared event handlers
  handlers: {
    onTaskUpdate,
    onAgentUpdate,
    onThreadUpdate
  }
};

// Use in layout
<script>
  import { appStore } from '$lib/stores';
  
  // Single subscription point
  $: ({ workspace, domain } = $appStore);
</script>
```

2. Proper Component Hierarchy:
```svelte
<!-- Layout.svelte -->
<div class="h-screen flex">
  <Navigation {workspace} {domain} />
  
  <main class="flex-1">
    <slot />
  </main>
  
  <!-- Single right panel -->
  <RightPanel>
    <slot name="details" />
  </RightPanel>
</div>

<!-- TaskBoard.svelte -->
<script>
  // Get data through props
  export let workspace;
  export let domain;
</script>

<div class="task-board">
  <!-- Task content only -->
</div>
```

3. Shared Components:
```svelte
<!-- SharedSearch.svelte -->
<div class="search-container">
  <input type="text" bind:value={$appStore.searchQuery} />
</div>

<!-- SharedNavigation.svelte -->
<nav>
  <ChannelList channels={$appStore.channels} />
  <SectionList sections={$appStore.sections} />
</nav>
```

4. Proper Event Delegation:
```typescript
// Single event handler at app level
appStore.socket.on('update', (event) => {
  switch(event.type) {
    case 'task':
      appStore.handlers.onTaskUpdate(event);
      break;
    case 'agent':
      appStore.handlers.onAgentUpdate(event);
      break;
  }
});
```

## Implementation Steps

1. Create Shared Components:
- Move common UI elements to shared components
- Standardize styling and behavior
- Remove duplicate implementations

2. Centralize State:
- Create unified app store
- Remove duplicate subscriptions
- Pass data through props

3. Fix Layout Structure:
- Use single navigation
- Use single right panel
- Proper component composition

4. Clean Up WebSocket:
- Single connection management
- Centralized event handling
- Proper event delegation

5. Standardize Styling:
- Use consistent widths/padding
- Proper spacing hierarchy
- Consistent color usage

The goal is to have a clean, maintainable codebase with proper component hierarchy and state management, similar to how Slack's UI is structured.

## Next Steps

1. Create shared component library
2. Implement central store
3. Refactor layout structure
4. Clean up duplicate code
5. Add proper TypeScript types
6. Improve error handling
7. Add loading states
8. Implement proper testing

This cleanup will significantly improve code maintainability and user experience while reducing potential bugs from state synchronization issues.

## Kanban Board Layout Issues

1. Visual Layout Problems:
- Columns are squished together without proper spacing
- No minimum width for columns causing content to wrap awkwardly
- Cards lack proper spacing and padding
- Text content not properly formatted within cards

2. TypeScript/WebSocket Issues:
- Missing WebSocketEvent type export
- WebSocket client missing send method
- Type mismatches in task update messages
- Inconsistent message type definitions

3. Attempted Fixes:
- Added proper grid layout with minmax columns:
  ```css
  grid-template-columns: repeat(4, minmax(280px, 1fr))
  ```
- Added minimum board width to prevent squishing:
  ```css
  min-width: 1200px
  ```
- Increased spacing between columns:
  ```css
  gap-6 p-6
  ```

4. Remaining Issues for Tomorrow:
- Fix WebSocket type definitions
- Add proper message interfaces
- Update client implementation
- Fix task update message format
- Add proper error handling
- Add loading states
- Add proper WebSocket reconnection logic

The layout improvements show the right direction, but we need to fix the underlying type system and WebSocket implementation to make it fully functional.
